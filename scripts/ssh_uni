function ssh_uni {
    # Config
    local host_login="login-stud.informatik.uni-bonn.de"
    local host_destination_default="robo18"
    local username_default="karacora"
    local ports_default="9999"

    function echo_help {
        echo "Usage:"
        echo "  ssh_uni [-H <host>] [-U <username>] <port1> <port2> ..."
        echo
        echo "Options:"
        echo "  -h, --help		Display this help message and exit."
        echo "  -H				Destination host name. Default is \"$host_destination_default\"."
        echo "  -U				Username at destination host. Default is \"$username_default\"."
        echo
        echo "Custom SSH command for connecting to a network node of the University of Bonn."
        echo "Jumps over $host_login if destination host is not directly reachable."
        echo "Ports [$ports_default] are always forwarded."
        echo
    }

    function parse_args {
        while getopts ":hH:U:" opt; do
            case $opt in
            h)
                echo_help
                exit 0
                ;;
            H)
                host_destination="$OPTARG"
                ;;
            U)
                username="$OPTARG"
                ;;
            \?)
                echo "Invalid option -$OPTARG" >&2
                exit 1
                ;;
            :)
                echo "Option -$OPTARG requires an argument." >&2
                exit 1
                ;;
            esac
        done
        # Shift out parsed options to get positional parameters
        shift $((OPTIND - 1))
        ports+="$@"

        echo "$host_destination $username $ports"
    }

    function ping_check {
        local ping_cmd="ping "
        ping_cmd+="$host_destination "
        ping_cmd+="-c 1 "
        ping_cmd+="&> /dev/null "

        eval "$ping_cmd"
        local exitstatus="$?"
        echo "$(($exitstatus == 0 ? 1 : 0))"
    }

    function construct_cmd {
        local ssh_cmd="ssh "
        ssh_cmd+="$username@$host_destination "

        if [ $(ping_check) == 0 ]; then
            ssh_cmd+="-J $username@$host_login "
        fi

        for port in $ports; do
            ssh_cmd+="-L ${port}:localhost:${port} "
        done

        echo "$ssh_cmd"
    }

    local host_destination="$host_destination_default"
    local username="$username_default"
    local ports="$ports_default "

    local vals_parsed=$(parse_args "$@")
    read -r host_destination username ports <<<"$vals_parsed"

    local ssh_cmd=$(construct_cmd)
    eval "$ssh_cmd"
}
